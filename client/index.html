<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Projektinhallinta</title>
	<link rel="stylesheet" href="bulma.css">
	<script src="js/axios.min.js"></script>
	<script src="js/vue.min.js"></script>
	<style>
		html, body {
			background: #202020;
			color: #D0D0D0;
		}
		.box, .input, .textarea, .label, .select, .content h1, .content h2{
			background: #303030;
			color: #D0D0D0;
		}
		.activetask {
			text-decoration: line-through;
		}
		.inactivetask {
			text-decoration: line-through;
			color: #606060;
		}

	</style>
</head>
<body>
<div class="container content" id="app">
	<div class="container">
		<p>
			<div class="content" v-for="project in projects">
				<h2>{{ project.name }}</h2>
				<ul>
					<ol v-for="task in tasks" v-if="task.project == project.name">
						<span v-on:click="ChangeTaskStatus(task)" v-bind:class="{ inactivetask: !task.status }">
							{{ task.desc }}
						</span>
					</ol>
				</ul>
			</div>
		</p>
	</div>

	<div class="box">
		<h1 class="title">Lisää uusi tehtävä</h1>
		<div class="field control">
			<label class="label">Kuvaus:</label>
			<textarea class="textarea" v-model="new_task.desc"></textarea>
		</div>

		<div class="field control">
			<label class="label">Tyyppi:</label>
			<input type="radio" class="radio" value="ajatus" v-model="new_task.type"> Ajatustyö
			<input type="radio" class="radio" value="mekaaninen" v-model="new_task.type"> Mekaaninen

		</div>

		<div class="field control">
			<label class="label">Projekti:</label>
			<div class="select is-multiple">
				<select v-model="new_task.project">
					<option v-for="project in projects">
						{{ project.name }}
					</option>
				</select>
			</div>
		</div>

		<div class="field control">
			<label class="label">Deadline:</label>
			<input type="text" class="input" v-model="new_task.deadline">
		</div>

		<div class="field control">
			<button class="button" v-on:click="NewTask">Hmm</button>
		</div>
	</div>

	<div class="box">
		<h1 class="title">Lisää uusi projekti</h1>
		<div class="field control">
			<label class="label">Nimi:</label>
			<input type="text" class="input" v-model="new_project.name">
		</div>

		<div class="field control">
			<button class="button" v-on:click="NewProject">Hmm</button>
		</div>
	</div>
</div>
	<script>

		var db = axios.create({
			baseURL: 'http://localhost:8081/'
		})

		async function GetFromServer(get_what) {
			app[get_what] = (await db.get(get_what)).data
		}

		function PostToServer(post_what, content, callback) {
			db.post(post_what, content)
					.then(function(response) {
						callback()
				})
		}

		function GetTasks() {
			GetFromServer('tasks')
		}

		function GetProjects() {
			GetFromServer('projects')
		}

		var app = new Vue({

			el: "#app",
			data: {
				new_task: {},
				new_project: {},
				tasks: [],
				projects: []
			},
			methods: {
				ChangeTaskStatus: function(task_data) {
					task_data.status = !task_data.status
					PostToServer("update_task", task_data)
				},
				NewProject: function() {
					PostToServer("new_project", app.new_project, GetProjects)
				},
				NewTask: function() {
					PostToServer("new_task", app.new_task, GetTasks)
				}
			}
		})
		
		GetTasks()
		GetProjects()

	</script>
</body>
</html>